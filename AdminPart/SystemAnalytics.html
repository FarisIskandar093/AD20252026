<!-- Replace the entire SystemAnalytics.html -->
<div class="w3-container">
    <h2 class="w3-text-purple">üìà System Analytics</h2>
    <p class="w3-text-grey">Comprehensive analytics and performance metrics</p>
    
    <!-- Analytics Dashboard -->
    <div class="w3-row-padding">
        <!-- Performance Metrics -->
        <div class="w3-col m12">
            <div class="w3-card w3-padding" style="border-radius: 10px;">
                <h4>üìä Performance Dashboard</h4>
                <div class="w3-row" id="performanceMetrics">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <div class="w3-row-padding w3-margin-top">
        <!-- Real-time Usage -->
        <div class="w3-col m8">
            <div class="w3-card w3-padding chart-card">
                <div class="chart-header">
                    <h4>üìà Real-time System Usage</h4>
                    <div class="w3-bar">
                        <button class="w3-button w3-purple w3-round w3-small" onclick="toggleUsageChart('day')">Day</button>
                        <button class="w3-button w3-light-grey w3-round w3-small" onclick="toggleUsageChart('week')">Week</button>
                        <button class="w3-button w3-light-grey w3-round w3-small" onclick="toggleUsageChart('month')">Month</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="usageChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- System Health -->
        <div class="w3-col m4">
            <div class="w3-card w3-padding" style="height: 100%;">
                <h4>‚ù§Ô∏è System Health</h4>
                <div class="w3-padding w3-center">
                    <div id="healthGauge" style="height: 200px;"></div>
                </div>
                <div class="w3-panel w3-light-green w3-round">
                    <p><strong>Status:</strong> <span id="systemStatus">All systems operational</span></p>
                    <p><strong>Uptime:</strong> <span id="uptimeStatus">99.8%</span></p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="w3-row-padding w3-margin-top">
        <!-- Resource Distribution -->
        <div class="w3-col m6">
            <div class="w3-card w3-padding chart-card">
                <div class="chart-header">
                    <h4>‚öñÔ∏è Resource Distribution</h4>
                </div>
                <div class="chart-container">
                    <canvas id="resourceChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Efficiency Metrics -->
        <div class="w3-col m6">
            <div class="w3-card w3-padding chart-card">
                <div class="chart-header">
                    <h4>üéØ Efficiency Metrics</h4>
                </div>
                <div class="chart-container">
                    <canvas id="efficiencyChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Controls -->
    <div class="w3-center w3-padding-24">
        <button class="w3-button w3-purple w3-large w3-round" onclick="refreshAnalytics()">
            üîÑ Refresh Analytics
        </button>
        <button class="w3-button w3-blue w3-large w3-round" onclick="exportAnalyticsReport()">
            üìä Generate Report
        </button>
    </div>
</div>

<style>
#performanceMetrics .w3-col {
    padding: 10px;
}

.metric-card {
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    color: white;
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
}

.metric-card:hover {
    transform: translateY(-5px);
}

.metric-value {
    font-size: 32px;
    font-weight: bold;
    margin: 10px 0;
}

.metric-label {
    font-size: 14px;
    opacity: 0.9;
}

.gauge-container {
    position: relative;
    width: 200px;
    height: 200px;
    margin: 0 auto;
}

.gauge-circle {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.gauge-value {
    font-size: 36px;
    font-weight: bold;
    color: #333;
}

.gauge-label {
    font-size: 14px;
    color: #666;
}
</style>

<script src="../JS/Authenticate.js"></script>
<script src="VisualizationHelper.js"></script>
<script>
// Chart instances
let usageChart, resourceChart, efficiencyChart;
let usagePeriod = 'day';

$(document).ready(function() {
    loadPerformanceMetrics();
    loadUsageChart();
    loadResourceChart();
    loadEfficiencyChart();
    updateSystemHealth();
});

function loadPerformanceMetrics() {
    const metrics = [
        { label: 'Active Users', value: '142', change: '+12%', color: '#9c27b0', icon: 'üë•' },
        { label: 'API Response', value: '98ms', change: '-5ms', color: '#2196f3', icon: '‚ö°' },
        { label: 'Data Volume', value: '15.2K', change: '+3%', color: '#4caf50', icon: 'üíæ' },
        { label: 'Success Rate', value: '99.8%', change: '+0.2%', color: '#ff9800', icon: '‚úÖ' }
    ];
    
    let html = '';
    metrics.forEach(metric => {
        html += `
            <div class="w3-col m3">
                <div class="metric-card" style="background: ${metric.color}">
                    <div class="w3-xlarge">${metric.icon}</div>
                    <div class="metric-value">${metric.value}</div>
                    <div class="metric-label">${metric.label}</div>
                    <div class="w3-small">${metric.change} from last week</div>
                </div>
            </div>
        `;
    });
    
    $('#performanceMetrics').html(html);
}

function loadUsageChart() {
    const canvas = document.getElementById('usageChart');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    
    // Sample data based on period
    let labels, data1, data2;
    
    switch(usagePeriod) {
        case 'day':
            labels = ['8AM', '10AM', '12PM', '2PM', '4PM', '6PM', '8PM'];
            data1 = [45, 78, 92, 85, 65, 42, 25];
            data2 = [120, 185, 220, 195, 160, 110, 75];
            break;
        case 'week':
            labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            data1 = [320, 340, 310, 350, 280, 120, 80];
            data2 = [850, 920, 880, 950, 750, 400, 250];
            break;
        case 'month':
            labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
            data1 = [1250, 1380, 1420, 1350];
            data2 = [3200, 3500, 3650, 3450];
            break;
    }
    
    if (usageChart) usageChart.destroy();
    
    usageChart = VisualizationHelper.createLineChart('usageChart', labels, [
        {
            label: 'User Activity',
            data: data1,
            borderColor: '#9c27b0',
            backgroundColor: 'rgba(156, 39, 176, 0.1)',
            fill: true
        },
        {
            label: 'System Load',
            data: data2,
            borderColor: '#2196f3',
            backgroundColor: 'rgba(33, 150, 243, 0.1)',
            fill: true,
            yAxisID: 'y1'
        }
    ], `System Usage - ${usagePeriod.charAt(0).toUpperCase() + usagePeriod.slice(1)}ly View`);
}

function toggleUsageChart(period) {
    usagePeriod = period;
    
    // Update button styles
    $('.w3-bar .w3-button').removeClass('w3-purple').addClass('w3-light-grey');
    $(`.w3-bar .w3-button:contains('${period.charAt(0).toUpperCase() + period.slice(1)}')`)
        .removeClass('w3-light-grey').addClass('w3-purple');
    
    loadUsageChart();
}

function loadResourceChart() {
    const canvas = document.getElementById('resourceChart');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    
    const labels = ['CPU', 'Memory', 'Storage', 'Network', 'Database'];
    const usage = [65, 78, 42, 55, 88];
    const capacity = [100, 100, 100, 100, 100];
    
    if (resourceChart) resourceChart.destroy();
    
    resourceChart = VisualizationHelper.createChart('resourceChart', {
        type: 'radar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Current Usage',
                    data: usage,
                    backgroundColor: 'rgba(156, 39, 176, 0.2)',
                    borderColor: '#9c27b0',
                    borderWidth: 2,
                    pointBackgroundColor: '#9c27b0'
                },
                {
                    label: 'Capacity',
                    data: capacity,
                    backgroundColor: 'rgba(33, 150, 243, 0.1)',
                    borderColor: '#2196f3',
                    borderWidth: 1,
                    borderDash: [5, 5],
                    pointBackgroundColor: '#2196f3'
                }
            ]
        },
        options: {
            scales: {
                r: {
                    beginAtZero: true,
                    max: 100,
                    ticks: {
                        stepSize: 20,
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            },
            plugins: {
                title: {
                    display: true,
                    text: 'Resource Utilization',
                    font: { size: 16, weight: 'bold' }
                }
            }
        }
    });
}

function loadEfficiencyChart() {
    const labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
    const efficiency = [88, 92, 85, 95, 90];
    const target = [90, 90, 90, 90, 90];
    
    if (efficiencyChart) efficiencyChart.destroy();
    
    efficiencyChart = VisualizationHelper.createChart('efficiencyChart', {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Efficiency',
                    data: efficiency,
                    backgroundColor: VisualizationHelper.colors.green.map(c => c + 'CC'),
                    borderColor: VisualizationHelper.colors.green,
                    borderWidth: 1
                },
                {
                    label: 'Target',
                    data: target,
                    type: 'line',
                    borderColor: '#ff9800',
                    borderWidth: 3,
                    borderDash: [5, 5],
                    fill: false,
                    pointRadius: 0
                }
            ]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            },
            plugins: {
                title: {
                    display: true,
                    text: 'Weekly Efficiency vs Target',
                    font: { size: 16, weight: 'bold' }
                },
                annotation: {
                    annotations: {
                        targetLine: {
                            type: 'line',
                            yMin: 90,
                            yMax: 90,
                            borderColor: '#ff9800',
                            borderWidth: 2,
                            borderDash: [5, 5]
                        }
                    }
                }
            }
        }
    });
}

function updateSystemHealth() {
    const health = 95; // Simulated health score
    
    const gaugeHtml = `
        <div class="gauge-container">
            <svg width="200" height="200" viewBox="0 0 200 200">
                <!-- Background circle -->
                <circle cx="100" cy="100" r="90" fill="none" stroke="#f0f0f0" stroke-width="20"/>
                <!-- Progress circle -->
                <circle cx="100" cy="100" r="90" fill="none" stroke="${getHealthColor(health)}" 
                    stroke-width="20" stroke-dasharray="${2 * Math.PI * 90}" 
                    stroke-dashoffset="${2 * Math.PI * 90 * (1 - health / 100)}"
                    stroke-linecap="round" transform="rotate(-90 100 100)"/>
                <!-- Center text -->
                <text x="100" y="110" text-anchor="middle" font-size="36" font-weight="bold" fill="#333">
                    ${health}%
                </text>
                <text x="100" y="135" text-anchor="middle" font-size="14" fill="#666">
                    Health Score
                </text>
            </svg>
        </div>
    `;
    
    $('#healthGauge').html(gaugeHtml);
    
    // Update status
    let status, uptime;
    if (health >= 90) {
        status = 'Excellent';
        uptime = '99.9%';
    } else if (health >= 75) {
        status = 'Good';
        uptime = '99.8%';
    } else {
        status = 'Needs Attention';
        uptime = '99.5%';
    }
    
    $('#systemStatus').text(status);
    $('#uptimeStatus').text(uptime);
}

function getHealthColor(score) {
    if (score >= 90) return '#4caf50';
    if (score >= 75) return '#ff9800';
    return '#f44336';
}

function refreshAnalytics() {
    loadPerformanceMetrics();
    loadUsageChart();
    loadResourceChart();
    loadEfficiencyChart();
    updateSystemHealth();
    
    // Show refresh animation
    const button = event.target;
    const original = button.innerHTML;
    button.innerHTML = 'üîÑ Refreshing...';
    button.disabled = true;
    
    setTimeout(() => {
        button.innerHTML = original;
        button.disabled = false;
    }, 1500);
}

function exportAnalyticsReport() {
    alert('üìä Analytics Report Generated!\n\nReport includes:\n‚Ä¢ Performance metrics\n‚Ä¢ Usage trends\n‚Ä¢ Resource utilization\n‚Ä¢ Efficiency analysis\n\nReport would be downloaded as PDF in a real system.');
}
</script>