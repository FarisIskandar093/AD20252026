<html>
<head>
  <title>CourseList</title>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css"> 
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

  <style>
    #chart_div {
      margin: 0 auto; 
    }
  </style>

</head>
<body>

<div id="chart_div" style="width: 900px; height: 500px;"></div>
<hr>

<table class="w3-table-all w3-hoverable">
  <tr>
    <th>Course Name</th>
    <th>Course Code</th>
    <th>Sections</th>
    <th>Lecturers</th>
    <th>Students</th>
  </tr>

</table>
<p></p>

</body>
</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
var url = "http://web.fc.utm.my/ttms/web_man_webservice_json.cgi?entity=subjek&sesi=2025/2026&semester=1";

alert("Access TTMS-AJAX service");
fetch(url)
.then(res => res.json())
.then(jsonInst => { 
  
  for (var i = 0; i < jsonInst.length; i++) {
    
    var row = $('<tr></tr>');
    row.append('<td>' + jsonInst[i].nama_subjek + '</td>');
    row.append('<td>' + jsonInst[i].kod_subjek + '</td>');
    row.append('<td>' + jsonInst[i].bil_seksyen + '</td>');
    row.append('<td>' + jsonInst[i].bil_pensyarah + '</td>');
    row.append('<td>' + jsonInst[i].bil_pelajar + '</td>');
    
    $('table').append(row);
  }
  
  jsonInst.sort((a, b) => +b.bil_pelajar - +a.bil_pelajar);
  var top10Courses = jsonInst.slice(0, 10);
  google.charts.load('current', {'packages':['bar']});
  google.charts.setOnLoadCallback(drawChart);

  function drawChart() {

    var data = new google.visualization.DataTable();
    data.addColumn('string', 'Course Name');
    data.addColumn('number', 'Students');
    
    var chartData = top10Courses.map(course => 
      [course.nama_subjek, +course.bil_pelajar]
    );
    
    data.addRows(chartData);

    var options = {
      title: 'Top 10 Courses',
      hAxis: {
          title: 'Total Population',
          minValue: 0
      },
      vAxis: {
          title: 'Course Name'
      },
      bars: 'horizontal'
    };

    var chart = new google.charts.Bar(document.getElementById('chart_div'));
    chart.draw(data, google.charts.Bar.convertOptions(options));
  }
  
}).catch(err => console.log(err));
</script>